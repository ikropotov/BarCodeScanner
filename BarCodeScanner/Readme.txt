Комплекс программ для сканирования штрихкодов отгружаемой продукции
Часть 3 - ПО для терминала сбора данных

Содержание
1. Назначение
2. Состав комплекса
3. Общая схема работы программного комплекса
4. Запуск программы 
5. Загрузка документов в сканер
6. Сканирование штрихкодов
7. Выгрузка документов из сканера
8. Сервисный режим и дополнительные функции
9. Прочие замечания



1. Назначение


Программный комплекс разработан для учёта продукции посредством сканирования индивидуальных уникальных штрихкодов.
Такой штрихкод присваивается каждой единице продукции на этапе производства и физически наклеивается на неё в
виде отпечатанной этикетки со штрихкодом. Впоследствии по номеру штрихкода можно определить когда и кем произведена продукция,
посмотреть результаты испытательных тестов, отследить движение продукции из цеха в склад и отгрузку потребителю.
Этот-же штрихкод печатается в отгрузочных документах.

Кроме учёта при отгрузке, осуществляется также учёт движения готовой продукции по местам производства/хранения - выходам конвейеров в цехах, 
складам внутризаводским, складам на ж/д станции. Из всех этих мест продукция может отгружаться потребителям а также может перемещаться между
различными складами (не может только возвращаться назад на конвейер).

В одну погрузочную единицу (автомобиль или вагон) грузят несколько десятков/сотен единиц продукции разных типов.



2. Состав комплекса


Комплекс программ состоит из трёх частей:
	1) Часть, написанная на 1С
		- отвечает за ввод первичных документов, печать отгрузочных документов, хранение данных
		- здесь-же, в 1С, реализовано управление промышленным термотрансферным принтером, который печатает штрихкоды 
			на самоклеющихся кислото-термо-износоустойчивых этикетках
	2) Промежуточный сервис
		- запущен на том-же сервере, где расположена 1С
		- обмен данными с 1С осуществляется через COM-соединение
		- обмен дынными со сканерами производится через REST API посредством вэб-сервера IIS
	3) Программа на терминале сбора данных
		- принимает исходные данные (список продукции) через Wi-Fi
		- сканирует штрихкоды, сверяясь со списком
		- передаёт отсканированные данные обратно



3. Общая схема работы программного комплекса


	1) В 1С создаётся и печатается документ на перемещение или отгрузку продукции (содержит количество и тип продукции)
	2) Документ передаётся в склад
	3) Кладовщик сканирует штрихкод в шапке документа и сканер получает этот документ через Wi-Fi
	4) Согласно списка отгружается и сканируется продукция
	5) После окончания отгрузки (или в конце рабочего дня) отсканированные штрихкоды передаются в 1С



4. Запуск программы 


При старте программы запрашивается пароль. Пароль состоит из 6 цифр и вводится с цифровой клавиатуры сканера. 
Введённый пароль сверяется с данными пользователей из файла settings.xml. Если найдено соответствие - из настроек
берётся имя пользователя и запускается основная форма приложения.



5. Загрузка документов в сканер


Чтобы загрузить документ в сканер, нужно отсканировать его штрихкод с бумажной копии документа или ввести номер
и дату документа вручную. Это делается из основной формы программы, отображающей список имеющихся в сканере документов. 
При этом сканер должен находиться в зоне действия заводской Wi-Fi сети. Если документ не найден или отсутствует связь 
с сервером - будут показаны соответствующие сообщения об ошибках. 

Если документ уже загружен в какой-либо из сканеров, его повторная загрузка блокируется. В этом случае сначала нужно
вернуть документ из сканера на сервер (номер сканера будет показан в сообщении об ошибке загрузки документа).

Передаваемый в сканер документ может содержать не только списки продукции, но и штрихкоды уже отсканированных
изделий. Это сделано для обработки ситуаций, когда продукция в один автомобиль грузится с нескольких складов и,
соответственно, сначала сканируется на одном сканере в первом складе, а затем на втором сканере во втором складе.
При этом запись по каждому штрихкоду содержит имя кладовщика, дату, время сканирования и номер сканера.



6. Сканирование штрихкодов


Для сканирования штрихкодов нужно открыть список продукции документа (Enter в основной форме на нужной строке).

Перед сканированием нужно выбрать направление перемещения/отгрузки продукции - откуда и куда.

Сканирование производится нажатием на сканере специально выделенных оранжевых кнопок. Во время сканирования раздаётся 
короткий звуковой сигнал и в списке продукции на строке с соответствующим типом продукции увеличивается количество. 
Увеличивается также общее количество отсканированной по этому документу продукции (в правом верхнем углу).

Если сканирование какого-либо типа продукции ещё не производилось - фон у строки будет белый. Отсканировано меньше,
чем необходимо - фон красный. Когда отсканировано нужное количество продукции какого-либо типа - раздаётся многократный 
звуковой сигнал, срабатывает вибромотор сканера и выдаётся сообщение, что грузить этот тип продукции больше не надо.
После этого фон строки с этим типом продукции становится зелёным.

Аналогичная цветовая маркировка применяется и на основной форме - только там она относится не к определённому типу продукции,
а к содержимому всего документа.

При попытке отсканировать штрихкод с типом, которого нет в текущем списке продукции, будет выдано сообщение об ошибке,
а также звуковой и вибро сигналы.

Если нажать Enter на строке с типом продукции - открывается список отсканированных по этой продукции штрихкодов.
Enter на штрихкоде - входим в форму, показывающую полную информацию по штрихкоду - кто и когда сканировал, тип продукции и т.д.

В списке штрихкодов можно удалить ошибочно отсканированный штрихкод. При этом он будет помечен красным фоном.

Во время сканирования штрихкодов подключение к Wi-Fi не требуется. Это позволяет сканировать продукцию в таких местах,
где отсутствует заводская беспроводная сеть.



7. Выгрузка документов из сканера


Для отправки документов на сервер необходим доступ сканера к заводской сети через Wi-Fi. 

Возможна отправка как полностью заполненного документа, так и документа, в котором продукция отсканирована лишь частично.

После отправки будет выдано сообщение с количеством переданных штрихкодов.

Если отправка прошла успешно - файл документа автоматически удаляется из сканера. 

Если документ не удаляется - значит, он не передался по какой-либо причине (нет связи с сервером или в 1С не найден соответствующий
документ). 



8. Сервисный режим и дополнительные функции


На этапе ввода пароля или на основной форме приложения доступны две волшебных комбинации клавиш - ..11.. и .1111.

Первая - перезагрузка сканера (SoftReset).  Это замена кнопке Reset сзади сканера. Не всегда при себе есть тонкий
острый предмет, чтобы попасть в это маленькое отверстие.

Вторая комбинация - вход в сервисный режим. В сервисном режиме доступны такие действия:
	1) Заново получить настройки
		Это бывает необходимо, когда появляются новые кладовщики, новые места погрузки и т.п.
	2) Список документов
		Здесь можно посмотреть список загруженных на сканер документов или удалить какой-либо документ (Внимание! Отсканированные штрихкоды пропадут!)
	3) Посмотреть лог
		Сейчас идёт тестовое внедрение и логов очень много, протоколируется всё что только можно. Впоследствии количество логов будет уменьшено,
		но они всё равно будут, и иногда их нужно будет смотреть.
	4) Очистить лог
		Поскольку логов много, они очень быстро разрастаются. При достижении Config.maxLogSize текущий лог автоматически копируется в log_old.txt, 
		после чего очищается. Однако, иногда нужно начать новый лог не дожидаясь, пока он достигнет максимального размера.
	5) Получить время
		Выполняется принудительная синхронизация времени с сервером. В основном применяется не для установки времени, а для проверки работоспособности 
		промежуточного сервиса (пункт 2 из состава комплекса). Непосредственно для установки времени оно не надо, т.к. при загрузке документов сканер 
		самостоятельно синхронизирует время с сервером.
	6) Тест связи с 1С
		Если промежуточный сервис работает, а документы не получаются или не передаются, то в этом пункте можно протестиорвать, отвечает-ли на запросы 1С.
 
В сервисном режиме даже без вызова каких-либо команд можно понять, работает-ли сеть, доступны-ли сервера - в окне ниже кнопок выводятся результаты
соответствующих тестов.



9. Прочие замечания


1) Хотя программа уже успешно работает, сейчас идёт этап тестового внедрения. В процессе которого уже много чего было переписано, дописано и наверняка
	будет доделываться ещё.
	
2) Логов реально много. Однако, проблемы возникают не только у программы на сканере, но и у промежуточного сервиса, и в 1С, и с сетью бывают проблемы,
	и пользователи иногда такое учудят, что специально не придумаешь. Вобщем, логи помогают отладиться. Потом это всё уберётся.
	
3) Пароли не зашифрованы. Они там нужны в основном для того, чтобы скучающие в складе грузчики чего-нибудь случайно не наклацали.

4) IP адрес сервера 1С пока-что прописан жёстко. Позже будет перенесено в настройки.

5) Используемый терминал сбора данных - Casio IT-800R-15 с модулем лазерного считывания штрихкодов, работает под управлением Windows Mobile 6

